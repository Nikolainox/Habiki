<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Project 1.9 â€“ Greatness League PRO Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Poppins,sans-serif;background:#06111a;color:#fff;text-align:center}
h1{color:#00eaff;text-shadow:0 0 12px #00eaff;margin:20px 0}
.container{max-width:950px;margin:auto;padding:10px}
#calendar{display:grid;grid-template-columns:repeat(9,1fr);gap:5px;margin:20px auto}
.card{background:#0e1f2f;border:1px solid #00eaff30;border-radius:10px;padding:8px;cursor:pointer;transition:.3s}
.card:hover{transform:scale(1.03)}
.card.finalized{box-shadow:0 0 10px #00eaff70}
button{background:linear-gradient(90deg,#ff0080,#7928ca);border:none;color:#fff;border-radius:20px;padding:8px 16px;margin:5px;cursor:pointer;font-weight:600}
#popup{position:absolute;background:#001726ee;border:1px solid #00eaff;border-radius:8px;padding:10px;display:none;z-index:20}
.sectionTitle{color:#00eaff;margin-top:6px}
.habit{display:flex;align-items:center;justify-content:space-between;margin:4px 0}
#chartContainer{width:90%;margin:20px auto;display:none}
canvas{background:#111;border-radius:10px}
#scoreboard{background:#0b1926;border:1px solid #00eaff30;border-radius:12px;padding:10px;margin:15px auto;width:85%}
input[type=number]{width:60px;text-align:center;border:none;border-radius:4px}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ’ Greatness League PRO â€“ 90 Day Tracker</h1>

<div>
<button onclick="addHabit()">â• Add Good Habit</button>
<button onclick="addMistake()">â• Add Mistake Habit</button>
<button onclick="toggleChart()">ğŸ“ˆ Stats</button>
<button onclick="showScoreboard()">ğŸ† Team Board</button>
</div>

<div id="habitList"></div>
<div id="mistakeList"></div>
<div id="calendar"></div>
<div id="popup"></div>
<div id="scoreboard" style="display:none;"></div>
<div id="chartContainer"><canvas id="progressChart" height="200"></canvas></div>
</div>

<script>
const totalDays=90;
let habits=JSON.parse(localStorage.getItem("habits")||"[]");
let mistakes=JSON.parse(localStorage.getItem("mistakes")||"[]");
let days=JSON.parse(localStorage.getItem("days")||"[]");
if(days.length===0){
  for(let i=1;i<=totalDays;i++)
    days.push({id:i,checks:[],errors:[],goalAvg:0,score:0,finalized:false});
}
let chart;

/* --- RENDER HABITS --- */
function renderHabits(){
  const list=document.getElementById("habitList");
  list.innerHTML="<h3 class='sectionTitle'>âœ… Good Habits</h3>";
  habits.forEach((h,i)=>{
    const div=document.createElement("div");
    div.className="habit";
    div.innerHTML=`<span>${h}</span><button onclick="delHabit(${i})">ğŸ—‘ï¸</button>`;
    list.appendChild(div);
  });
}
function renderMistakes(){
  const list=document.getElementById("mistakeList");
  list.innerHTML="<h3 class='sectionTitle'>ğŸŸ¥ Mistake Habits</h3>";
  mistakes.forEach((m,i)=>{
    const div=document.createElement("div");
    div.className="habit";
    div.innerHTML=`<span>${m}</span><button onclick="delMistake(${i})">ğŸ—‘ï¸</button>`;
    list.appendChild(div);
  });
}
function addHabit(){
  const name=prompt("Good habit name:");
  if(!name)return;
  habits.push(name);
  days.forEach(d=>d.checks.push(false));
  save();renderHabits();renderCalendar();
}
function addMistake(){
  const name=prompt("Mistake habit name:");
  if(!name)return;
  mistakes.push(name);
  days.forEach(d=>d.errors.push(false));
  save();renderMistakes();renderCalendar();
}
function delHabit(i){
  habits.splice(i,1);
  days.forEach(d=>d.checks.splice(i,1));
  save();renderHabits();renderCalendar();
}
function delMistake(i){
  mistakes.splice(i,1);
  days.forEach(d=>d.errors.splice(i,1));
  save();renderMistakes();renderCalendar();
}

/* --- CALENDAR --- */
const cal=document.getElementById("calendar");
function renderCalendar(){
  cal.innerHTML="";
  days.forEach(d=>{
    const el=document.createElement("div");
    el.className="card"+(d.finalized?" finalized":"");
    el.style.background=colorByScore(d.score);
    el.innerHTML=`<h4>Day ${d.id}</h4><p>${(d.goalAvg||0).toFixed(1)}</p>`;
    el.onclick=e=>openPopup(e,d.id);
    cal.appendChild(el);
  });
}
function colorByScore(s){
  if(s>0.7)return"#00800080";
  if(s>0.4)return"#99990080";
  if(s>0)return"#66000080";
  return"#0e1f2f";
}

/* --- POPUP --- */
function openPopup(e,id){
  const d=days.find(x=>x.id===id);
  const p=document.getElementById("popup");
  p.style.left=e.pageX+"px";
  p.style.top=e.pageY+"px";
  let html=`<b>ğŸ’ Day ${id}</b><br>`;
  html+="<h4>âœ… Good Habits</h4>";
  habits.forEach((h,i)=>{
    const checked=d.checks[i]?"checked":"";
    html+=`<label><input type="checkbox" ${checked} onchange="toggleCheck(${id},${i})"/> ${h}</label><br>`;
  });
  html+="<h4>ğŸŸ¥ Mistake Habits</h4>";
  mistakes.forEach((m,i)=>{
    const checked=d.errors[i]?"checked":"";
    html+=`<label><input type="checkbox" ${checked} onchange="toggleError(${id},${i})"/> ${m}</label><br>`;
  });
  html+=`ğŸ¯ Goal Avg <input type="number" id="goal${id}" min="0" max="10" value="${d.goalAvg}"><br>
  <button onclick="saveGoal(${id})">ğŸ’¾ Save</button>
  <button onclick="finalizeDay(${id})">âœ… Finalize</button>`;
  p.innerHTML=html;p.style.display="block";
}
window.addEventListener("click",e=>{
  if(!e.target.closest("#popup"))document.getElementById("popup").style.display="none";
});
function toggleCheck(dayId,hIndex){
  const d=days.find(x=>x.id===dayId);
  d.checks[hIndex]=!d.checks[hIndex];
  save();
}
function toggleError(dayId,hIndex){
  const d=days.find(x=>x.id===dayId);
  d.errors[hIndex]=!d.errors[hIndex];
  save();
}
function saveGoal(id){
  const val=parseFloat(document.getElementById("goal"+id).value)||0;
  const d=days.find(x=>x.id===id);
  d.goalAvg=Math.max(0,Math.min(10,val));
  save();
}

/* --- FINALIZE --- */
function finalizeDay(id){
  const d=days.find(x=>x.id===id);
  const done=d.checks.filter(x=>x).length;
  const habitSuccess=habits.length?done/habits.length:0;
  const mistakesMade=d.errors.filter(x=>x).length;
  const mistakeRate=mistakes.length?mistakesMade/mistakes.length:0;
  const goalRate=(d.goalAvg/10)||0;
  const finalizedCount=days.filter(x=>x.finalized).length;
  const consistency=finalizedCount/totalDays;

  let score=(( (habitSuccess + goalRate - mistakeRate)/2 )*0.7 + consistency*0.3);
  score=Math.max(0,Math.min(1,score));
  d.score=parseFloat(score.toFixed(2));
  d.finalized=true;
  save();renderCalendar();
  alert(`ğŸ’ Day ${id} Finalized â€“ Pat Riley Score: ${d.score}`);
}

/* --- CHART --- */
function toggleChart(){
  const c=document.getElementById("chartContainer");
  c.style.display=c.style.display==="none"?"block":"none";
  if(c.style.display==="block")drawChart();
}
function drawChart(){
  const ctx=document.getElementById("progressChart").getContext("2d");
  if(chart)chart.destroy();
  const finalized=days.filter(d=>d.finalized);
  chart=new Chart(ctx,{
    type:"line",
    data:{
      labels:finalized.map(d=>d.id),
      datasets:[
        {label:"Pat Riley Score",data:finalized.map(d=>d.score),borderColor:"#00eaff",fill:false},
        {label:"Goal Avg",data:finalized.map(d=>d.goalAvg/10),borderColor:"#ff0080",fill:false},
        {label:"Consistency",data:finalized.map((_,i)=>(i+1)/totalDays),borderColor:"#00ff88",fill:false},
        {label:"Mistake Rate",data:finalized.map(d=>{
          const made=d.errors.filter(x=>x).length;
          return mistakes.length?made/mistakes.length:0;
        }),borderColor:"#ff3333",fill:false}
      ]
    },
    options:{scales:{y:{beginAtZero:true,max:1}},plugins:{legend:{labels:{color:"#fff"}}}}
  });
}

/* --- SCOREBOARD --- */
function showScoreboard(){
  const s=document.getElementById("scoreboard");
  if(s.style.display==="block"){s.style.display="none";return;}
  const finalized=days.filter(d=>d.finalized);
  if(finalized.length===0){alert("No finalized days yet!");return;}
  const avg=(finalized.reduce((sum,d)=>sum+d.score,0)/finalized.length).toFixed(2);
  const avgMistake=(finalized.reduce((sum,d)=>sum+(d.errors.filter(x=>x).length),0)/(finalized.length*mistakes.length)||0).toFixed(2);
  const top=[...finalized].sort((a,b)=>b.score-a.score).slice(0,5);
  let html=`<h3>ğŸ† Team Board</h3><p>Games Played: ${finalized.length}/90</p>
  <p>Team Avg Score: ${avg} | Avg Mistake Rate: ${avgMistake}</p>
  <table style="margin:auto"><tr><th>Day</th><th>Score</th></tr>`;
  top.forEach(t=>html+=`<tr><td>${t.id}</td><td>${t.score}</td></tr>`);
  html+=`</table>`;
  s.innerHTML=html;s.style.display="block";
}

/* --- SAVE --- */
function save(){
  localStorage.setItem("habits",JSON.stringify(habits));
  localStorage.setItem("mistakes",JSON.stringify(mistakes));
  localStorage.setItem("days",JSON.stringify(days));
}
renderHabits();renderMistakes();renderCalendar();
</script>
</body>
</html>
