<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Project 1 ‚Äì Smart 90-Day Calendar + Pat Riley Tracker</title>
<style>
body{
  font-family:'Poppins',sans-serif;
  background:linear-gradient(160deg,#7f00ff,#e100ff);
  color:#fff;margin:0;padding:20px;text-align:center;
}
.container{max-width:640px;margin:auto;}
#calendar{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:4px;margin-top:10px;
}
.day{
  background:rgba(255,255,255,0.1);
  border-radius:8px;
  padding:10px;
  cursor:pointer;
  font-weight:600;
  transition:.2s;
}
.day:hover{transform:scale(1.08);}
.day.completed{background:#00eaff;color:#000;}
.popup{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.6);
  display:flex;justify-content:center;align-items:center;
}
.hidden{display:none;}
.popup-content{
  background:#222;border-radius:16px;
  padding:20px;max-width:360px;width:90%;
  text-align:left;
}
button{
  border:none;padding:8px 14px;border-radius:25px;
  font-weight:600;color:#fff;cursor:pointer;
  background:linear-gradient(90deg,#ff0080,#7928ca);
  margin:4px;
}
#habitSection .item,#goalSection .item{
  display:flex;justify-content:space-between;margin:6px 0;
}
#dayScore{text-align:center;font-size:20px;font-weight:700;margin:10px 0;}
canvas{margin-top:30px;}
</style>
</head>
<body>
<div class="container">
  <h1>Smart 90-Day Calendar üèí + Pat Riley Tracker</h1>
  <div id="calendar"></div>

  <!-- popup card -->
  <div id="dayPopup" class="popup hidden">
    <div class="popup-content">
      <h2 id="popupTitle">Day 1</h2>
      <div id="habitSection"></div>
      <div id="goalSection"></div>
      <div id="dayScore">Score 0 %</div>
      <div class="buttons">
        <button onclick="startDay()">Start Day</button>
        <button onclick="finalizeDay()">Finalize Day</button>
        <button onclick="closePopup()">Close</button>
      </div>
    </div>
  </div>

  <canvas id="rileyChart" height="150"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ---------- defaults ----------
let habits=["Wake up early","Workout","Read"];
let goals=["Stay focused","Eat clean"];
let days=JSON.parse(localStorage.getItem("days")||"{}");
let selectedDay=null;
const cal=document.getElementById("calendar");

// ---------- render calendar ----------
function renderCalendar(){
  cal.innerHTML="";
  for(let i=1;i<=90;i++){
    const d=document.createElement("div");
    d.className="day";
    if(days[i]?.finalized)d.classList.add("completed");
    d.textContent=i;
    d.onclick=()=>openDay(i);
    cal.appendChild(d);
  }
  drawRileyChart();
}
renderCalendar();

// ---------- popup ----------
function openDay(num){
  selectedDay=num;
  document.getElementById("dayPopup").classList.remove("hidden");
  document.getElementById("popupTitle").innerText=`Day ${num}`;
  renderPopup();
}
function closePopup(){
  document.getElementById("dayPopup").classList.add("hidden");
  saveData();renderCalendar();
}

// ---------- habits & goals ----------
function renderPopup(){
  const hs=document.getElementById("habitSection");
  hs.innerHTML="<h3>Habits</h3>";
  habits.forEach((h,i)=>{
    const item=document.createElement("div");item.className="item";
    const done=days[selectedDay]?.habitsDone?.[i]||false;
    item.innerHTML=`<span>${h}</span>
      <input type='checkbox' ${done?"checked":""}
      onchange='toggleHabit(${i},this.checked)'>`;
    hs.appendChild(item);
  });
  const gs=document.getElementById("goalSection");
  gs.innerHTML="<h3>Goals</h3>";
  goals.forEach((g,i)=>{
    const item=document.createElement("div");item.className="item";
    const done=days[selectedDay]?.goalsDone?.[i]||false;
    item.innerHTML=`<span>${g}</span>
      <input type='checkbox' ${done?"checked":""}
      onchange='toggleGoal(${i},this.checked)'>`;
    gs.appendChild(item);
  });
  updateScore();
}
function toggleHabit(i,checked){
  days[selectedDay]=days[selectedDay]||{habitsDone:[],goalsDone:[]};
  days[selectedDay].habitsDone[i]=checked;updateScore();
}
function toggleGoal(i,checked){
  days[selectedDay]=days[selectedDay]||{habitsDone:[],goalsDone:[]};
  days[selectedDay].goalsDone[i]=checked;updateScore();
}

// ---------- score & Pat Riley formula ----------
function updateScore(){
  const d=days[selectedDay]||{};
  const h=(d.habitsDone||[]).filter(Boolean).length;
  const g=(d.goalsDone||[]).filter(Boolean).length;
  const total=habits.length+goals.length||1;
  const score=Math.round(((h+g)/total)*100);
  d.score=score;days[selectedDay]=d;
  document.getElementById("dayScore").innerText=`Score ${score}%`;
  saveData();drawRileyChart();
}
function startDay(){alert(`Day ${selectedDay} started! Track your goals.`);}
function finalizeDay(){
  if(!selectedDay)return;
  days[selectedDay].finalized=true;
  saveData();renderCalendar();drawRileyChart();
  alert(`Day ${selectedDay} finalized!`);
}

// ---------- Pat Riley chart ----------
let chart;
function drawRileyChart(){
  const ctx=document.getElementById("rileyChart").getContext("2d");
  const labels=[],scores=[];
  for(let i=1;i<=90;i++){
    if(days[i]?.finalized){labels.push(i);scores.push(days[i].score);}
  }
  const avg=scores.map((_,i)=>{
    const slice=scores.slice(Math.max(0,i-6),i+1);
    return slice.reduce((a,b)=>a+b,0)/slice.length;
  });
  if(chart)chart.destroy();
  chart=new Chart(ctx,{
    type:"line",
    data:{labels:labels,
      datasets:[
        {label:"Daily Score %",data:scores,borderColor:"#00eaff",fill:false},
        {label:"7-Day Avg (CBE Line)",data:avg,borderColor:"#ffd700",fill:false,borderDash:[5,5]}
      ]},
    options:{scales:{y:{beginAtZero:true,max:100}}}
  });
}

// ---------- storage ----------
function saveData(){localStorage.setItem("days",JSON.stringify(days));}
document.addEventListener("keydown",e=>{if(e.key==="Escape")closePopup();});
</script>
</body>
</html>
